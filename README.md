# 📈 Arbitrade - 加密貨幣套利交易系統

專業的加密貨幣套利交易平台，幫助您自動捕捉不同交易所之間的價差機會，實現穩定收益。

## 🎯 什麼是 Arbitrade？

Arbitrade 是一個自動化套利交易系統，可以：
- **自動監控價差**：24/7 監控多個交易所之間的價格差異
- **自動執行交易**：當價差達到您設定的條件時，自動下單交易
- **降低交易成本**：使用 TWAP 策略將大單拆分，減少市場衝擊
- **實時追蹤績效**：隨時查看您的倉位、盈虧和交易記錄

## ✨ 主要功能

### 1️⃣ PAIRS 套利交易

**什麼是 PAIRS 套利？**
當同一個幣種在不同交易所或不同市場（現貨/合約）之間出現價格差異時，您可以同時在價格低的地方買入，在價格高的地方賣出，賺取價差。

**如何使用：**
1. 進入「交易」頁面
2. 選擇「PAIRS」模式
3. 設定兩個交易腿：
   - **第一腿**：選擇交易所、幣種、市場類型（現貨或合約）、買或賣
   - **第二腿**：選擇另一個交易所、幣種、市場類型、買或賣
4. 設定參數：
   - **數量**：每次要交易多少
   - **價差閾值**：當價差達到多少百分比時才執行（例如 0.1%）
   - **最大執行次數**：這個套利對最多執行幾次
5. 點擊「執行」，系統會自動監控並在達到條件時執行

**範例：**
- 在 Bybit 現貨市場買入 BTC，同時在 Binance 合約市場賣出 BTC
- 當兩個市場的價差達到 0.2% 時自動執行

### 2️⃣ TWAP 執行策略

**什麼是 TWAP？**
將一筆大單拆分成多個小單，在固定時間間隔內分批執行，可以降低對市場價格的影響，獲得更好的成交價格。

**如何使用：**
1. 進入「交易」頁面
2. 選擇「TWAP」模式
3. 設定兩個交易腿（與 PAIRS 類似）
4. 設定執行參數：
   - **單次數量**：每次下單要交易多少
   - **訂單數量**：總共要下幾個訂單
   - **執行間隔**：每個訂單之間間隔幾秒
5. 點擊「執行」，系統會按照您的設定自動分批執行

**範例：**
- 要買入 1 個 BTC，設定為每 10 秒下單 0.1 個 BTC，共 10 個訂單
- 系統會在 100 秒內完成所有訂單

**🆕 V3 格式改進：**
- ✅ 完整記錄格式：每次執行記錄一條完整的記錄（包含兩條腿）
- ✅ 數據完整性：記錄中包含完整配置信息，即使策略刪除也可查看
- ✅ 自動計算價差：直接顯示每次執行的價差和百分比
- ✅ 向後兼容：自動識別和轉換舊格式記錄
- 📖 詳細說明：參見 [TWAP V3 格式遷移指南](docs/TWAP_V3_FORMAT_MIGRATION.md)

### 3️⃣ 專業交易圖表

**價格走勢圖：**
- 同時顯示兩個交易所的價格走勢，方便對比
- 下方顯示價差率變化，讓您清楚看到套利機會
- 可以切換不同的時間週期（1分鐘、5分鐘、1小時等）
- 所有數據都是即時更新的

**如何使用圖表：**
- 點擊倉位卡片，圖表會自動切換到該交易對
- 使用滑鼠滾輪可以縮放圖表
- 拖拽可以查看不同時間段的數據

### 4️⃣ 倉位監控

**查看您的持倉：**
- 在交易台底部可以看到所有正在執行的套利對
- 每個倉位卡片顯示：
  - 兩個交易腿的詳細信息（交易所、幣種、方向）
  - 成交價格和當前價格
  - **實時盈虧**：綠色表示盈利，紅色表示虧損
  - 價差變化：開倉時的價差 vs 當前價差
  - 觸發次數：該套利對已經執行過幾次

**操作倉位：**
- 點擊倉位卡片，上方圖表會切換到該交易對
- 點擊「平倉」按鈕可以關閉該倉位

### 5️⃣ 績效分析

**查看您的交易表現：**
1. 進入「報表」頁面
2. 選擇要查看的時間範圍（日/周/月/全部）
3. 選擇要顯示的交易所
4. 查看：
   - 總淨值變化曲線
   - 各交易所的淨值變化
   - 盈虧金額和百分比

**淨值圖表說明：**
- 綠色粗線：所有交易所的總淨值
- 其他顏色線：各交易所的淨值
- 可以同時顯示多條曲線，方便對比

## 🚀 開始使用

### 第一步：配置交易所 API Key

在使用系統之前，您需要先配置交易所的 API Key。

**推薦方式：網頁配置**
1. 啟動系統後，進入「設置」頁面
2. 點擊「API 設置」頁籤
3. 選擇要配置的交易所（Bybit、Binance、OKX、Bitget）
4. 點擊「新增」或「修改」按鈕
5. 輸入您的 API Key 和 Secret Key
   - OKX 和 Bitget 還需要輸入 Password
6. 點擊「測試連接」確認配置正確
7. 點擊「保存」完成配置

**重要安全提示：**
- ⚠️ API Key 只需要開啟「交易」權限
- ⚠️ **絕對不要開啟「提現」權限**，以確保資金安全
- 建議為套利交易創建專用的 API Key

### 第二步：創建您的第一個套利對

1. 進入「交易」頁面
2. 在右側操作面板選擇「PAIRS」模式
3. 按照上面的說明配置參數
4. 點擊「執行」開始監控

### 第三步：監控您的交易

- 在交易台可以看到實時價格和價差
- 在底部「倉位監控」區域查看您的持倉
- 在「執行記錄」區域查看所有已完成的交易

## ✅ 支援的交易所

| 交易所 | 現貨交易 | 合約交易 | 說明 |
|--------|---------|---------|------|
| Bybit | ✅ | ✅ | 推薦使用，功能最完整 |
| Binance | ✅ | ✅ | 全球最大交易所 |
| OKX | ❌ | ✅ | 僅支援合約交易 |
| Bitget | ❌ | ✅ | 僅支援合約交易 |

**使用建議：**
- 如果要做現貨與合約之間的套利，建議使用 Bybit 或 Binance
- OKX 和 Bitget 只支援合約交易，適合做合約之間的套利

## 📊 界面說明

### 交易台布局

**上方：價格圖表**
- 顯示兩個交易所的價格走勢
- 下方顯示價差率變化

**右側：操作面板**
- 切換 PAIRS / TWAP 模式
- 配置交易參數
- 執行交易

**底部：三個區域**
- **執行中訂單**：正在執行的 TWAP 策略
- **倉位監控**：正在執行的套利對
- **歷史記錄**：所有已完成的交易

### 顏色說明

- **綠色**：盈利、上漲、買入
- **紅色**：虧損、下跌、賣出
- **金色**：重要操作按鈕
- **灰色**：次要信息

## 💡 使用技巧

### 設定合理的價差閾值

- **太小**（如 0.01%）：可能頻繁觸發，但利潤微薄，扣除手續費後可能虧損
- **太大**（如 1%）：機會較少，但利潤較高
- **建議**：根據幣種波動性設定，一般建議 0.1% - 0.5%

### 選擇合適的交易對

- **流動性好的幣種**：BTC、ETH 等主流幣，價差機會較少但穩定
- **波動性大的幣種**：小幣種，價差機會多但風險較高
- **建議**：從主流幣開始，熟悉系統後再嘗試其他幣種

### 監控資金費率

- 合約交易需要支付資金費率（每 8 小時一次）
- 如果資金費率過高，可能會吃掉套利利潤
- 建議在「倉位監控」中關注資金費率倒計時

### 設定最大執行次數

- 避免同一個套利對無限執行
- 建議根據市場情況設定合理的上限
- 可以隨時在「倉位監控」中手動平倉

## ⚠️ 風險提示

使用本系統進行交易前，請務必了解以下風險：

### 市場風險
- 加密貨幣市場波動劇烈，價格可能快速變化
- 套利機會可能轉瞬即逝，實際成交價格可能與預期不同

### 滑點風險
- 實際成交價格可能與顯示的價格有差異
- 特別是在市場波動劇烈時，滑點可能較大

### 資金費率風險
- 合約交易需要支付資金費率
- 如果資金費率過高，可能導致虧損

### 技術風險
- 網路延遲可能影響套利機會
- 交易所 API 可能出現暫時性故障

### 建議
- ✅ 先用小額資金測試系統功能
- ✅ 仔細檢查 API Key 權限設置（只開啟交易權限）
- ✅ 定期監控倉位和淨值變化
- ✅ 根據市場情況調整策略參數
- ✅ 不要投入超過您能承受損失的資金

## 📚 開發者文檔

### 核心文檔
- [V3 改進計劃](docs/V3.md) - V3 版本改進總覽與優化計劃
- [TWAP V3 格式遷移指南](docs/TWAP_V3_FORMAT_MIGRATION.md) - TWAP 記錄格式升級說明
- [部署快速開始](docs/DEPLOY_QUICK_START.md) - 部署指南與配置說明
- [開發指南](docs/dev.md) - 本地開發環境設置

### 技術特性
- **統一交易所接口**：使用 pybit、ccxt 等庫統一各交易所 API
- **物件導向架構**：遵循 SOLID 原則，易於擴展維護
- **非同步執行**：使用 asyncio 實現高效併發下單
- **完整錯誤處理**：包含回滾機制，確保交易安全
- **數據持久化**：使用 JSONL 格式記錄所有執行歷史

## 📞 需要幫助？

如果您在使用過程中遇到問題：

1. **配置問題**：檢查 API Key 是否正確配置，權限是否足夠
2. **交易問題**：查看「執行記錄」了解詳細錯誤信息
3. **技術問題**：聯繫技術支持團隊

---

**版本**：3.0.0  
**授權**：MIT
